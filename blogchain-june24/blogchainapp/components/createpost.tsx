"use client";

import React, { useState, useEffect } from "react";
import Web3 from "web3";
import { ethers } from "ethers";

import { Textarea } from "@/components/ui/textarea";
import { Button } from "@/components/ui/button";

interface NewPostFormProps {
  web3: Web3;
  account: string;
}

const MyValContract = {
  _format: "hh-sol-artifact-1",
  contractName: "MyValContract",
  sourceName: "contracts/Contract.sol",
  abi: [
    {
      inputs: [],
      stateMutability: "nonpayable",
      type: "constructor",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: false,
          internalType: "address",
          name: "recipient",
          type: "address",
        },
        {
          indexed: false,
          internalType: "uint256",
          name: "postId",
          type: "uint256",
        },
      ],
      name: "Addpost",
      type: "event",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: false,
          internalType: "uint256",
          name: "postId",
          type: "uint256",
        },
        {
          indexed: false,
          internalType: "bool",
          name: "isDeleted",
          type: "bool",
        },
      ],
      name: "Deletepost",
      type: "event",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: false,
          internalType: "uint256",
          name: "postId",
          type: "uint256",
        },
        {
          indexed: false,
          internalType: "address",
          name: "approver",
          type: "address",
        },
      ],
      name: "PostApproved",
      type: "event",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: false,
          internalType: "uint256",
          name: "postId",
          type: "uint256",
        },
        {
          indexed: false,
          internalType: "address",
          name: "liker",
          type: "address",
        },
      ],
      name: "PostLiked",
      type: "event",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: false,
          internalType: "uint256",
          name: "postId",
          type: "uint256",
        },
        {
          indexed: false,
          internalType: "bool",
          name: "isVerified",
          type: "bool",
        },
      ],
      name: "Validatepost",
      type: "event",
    },
    {
      inputs: [
        {
          internalType: "string",
          name: "postText",
          type: "string",
        },
        {
          internalType: "bool",
          name: "isDeleted",
          type: "bool",
        },
      ],
      name: "addpost",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      name: "approvals",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "",
          type: "address",
        },
      ],
      name: "ascention",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "_postId",
          type: "uint256",
        },
      ],
      name: "expertapprove",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "getAllposts",
      outputs: [
        {
          components: [
            {
              internalType: "uint256",
              name: "id",
              type: "uint256",
            },
            {
              internalType: "address",
              name: "username",
              type: "address",
            },
            {
              internalType: "string",
              name: "postText",
              type: "string",
            },
            {
              internalType: "bool",
              name: "isDeleted",
              type: "bool",
            },
            {
              internalType: "bool",
              name: "isVerified",
              type: "bool",
            },
            {
              internalType: "uint256",
              name: "likes",
              type: "uint256",
            },
            {
              internalType: "uint256",
              name: "approvals",
              type: "uint256",
            },
          ],
          internalType: "struct MyValContract.post[]",
          name: "",
          type: "tuple[]",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "_postId",
          type: "uint256",
        },
      ],
      name: "likePost",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      name: "likes",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "owner",
      outputs: [
        {
          internalType: "address",
          name: "",
          type: "address",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      name: "postRewards",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "tokenaddress",
      outputs: [
        {
          internalType: "address",
          name: "",
          type: "address",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "_postId",
          type: "uint256",
        },
      ],
      name: "validatepost",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
  ],
  bytecode:
    "0x608060405234801561001057600080fd5b50600180546001600160a01b0319163317905560405161002f90610071565b604051809103906000f08015801561004b573d6000803e3d6000fd5b50600080546001600160a01b0319166001600160a01b039290921691909117905561007e565b610c2680610e1683390190565b610d898061008d6000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c80638834c891116100715780638834c891146101545780638da5cb5b14610165578063aee5c34914610178578063bc7bf1c71461018d578063c9085875146101a0578063d4ccd5f3146101c057600080fd5b8063204ff240146100ae5780633feff76d146100c357806363035f66146100f3578063725009d3146101215780637e9dffe614610134575b600080fd5b6100c16100bc36600461096b565b6101d3565b005b6000546100d6906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b61011361010136600461096b565b60066020526000908152604090205481565b6040519081526020016100ea565b6100c161012f36600461096b565b6102c8565b61011361014236600461096b565b60056020526000908152604090205481565b6100c1610162366004610984565b50565b6001546100d6906001600160a01b031681565b61018061031c565b6040516100ea91906109b4565b6100c161019b36600461096b565b6105d8565b6101136101ae36600461096b565b60026020526000908152604090205481565b6100c16101ce366004610aee565b61078a565b60008181526006602052604081208054916101ed83610bb0565b9091555050600081815260066020526040902054600a101561028c5760016003828154811061021e5761021e610bd7565b906000526020600020906006020160030160016101000a81548160ff0219169083151502179055507fb1c8a09f3f65c01ce2ad5471f151a4d0ca61d365bcd286c0f0041845538f2b098160016040516102839291909182521515602082015260400190565b60405180910390a15b604080518281523360208201527fc6c773bb48fb8d38ada891d09df01af1f307f2a1bc38bb513c5cb1950150038191015b60405180910390a150565b60008181526005602052604081208054916102e283610bb0565b9091555050604080518281523360208201527fcf765d6f163c9b0d832e2a94f4c8e9bffd32a2c3ca5fdbb8cc67b5fe1441f41391016102bd565b60035460609060009067ffffffffffffffff81111561033d5761033d610aba565b60405190808252806020026020018201604052801561037657816020015b610363610921565b81526020019060019003908161035b5790505b5090506000805b600354811015610523576003818154811061039a5761039a610bd7565b6000918252602082206003600690920201015460ff161515900361051157600381815481106103cb576103cb610bd7565b90600052602060002090600602016040518060e0016040529081600082015481526020016001820160009054906101000a90046001600160a01b03166001600160a01b03166001600160a01b0316815260200160028201805461042d90610bed565b80601f016020809104026020016040519081016040528092919081815260200182805461045990610bed565b80156104a65780601f1061047b576101008083540402835291602001916104a6565b820191906000526020600020905b81548152906001019060200180831161048957829003601f168201915b5050509183525050600382015460ff8082161515602084015261010090910416151560408201526004820154606082015260059091015460809091015283518490849081106104f7576104f7610bd7565b6020026020010181905250818061050d90610bb0565b9250505b8061051b81610bb0565b91505061037d565b5060008167ffffffffffffffff81111561053f5761053f610aba565b60405190808252806020026020018201604052801561057857816020015b610565610921565b81526020019060019003908161055d5790505b50905060005b828110156105d05783818151811061059857610598610bd7565b60200260200101518282815181106105b2576105b2610bd7565b602002602001018190525080806105c890610bb0565b91505061057e565b509392505050565b600381815481106105eb576105eb610bd7565b906000526020600020906006020160030160019054906101000a900460ff16156106535760405162461bcd60e51b81526020600482015260156024820152741c1bdcdd08185b1c9958591e481d995c9a599a5959605a1b604482015260640160405180910390fd5b600081815260066020526040902054600a10156101625760016003828154811061067f5761067f610bd7565b906000526020600020906006020160030160016101000a81548160ff0219169083151502179055507fb1c8a09f3f65c01ce2ad5471f151a4d0ca61d365bcd286c0f0041845538f2b098160016040516106e49291909182521515602082015260400190565b60405180910390a160008181526004602081815260408084205460029092528084206064908190559354905163a9059cbb60e01b81526001600160a01b039283169381018490526024810185905292939291169063a9059cbb906044016020604051808303816000875af1158015610760573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107849190610c27565b50505050565b600380546040805160e0810182528281523360208201908152918101868152851515606083015260006080830181905260a0830181905260c0830181905260018501865594855281517fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b6006860290810191825593517fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85c850180546001600160a01b0319166001600160a01b039092169190911790559051939493919290917fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85d909101906108789082610c93565b506060820151600382018054608085015115156101000261ff00199315159390931661ffff199091161791909117905560a082015160048083019190915560c0909201516005909101556000838152602091825260409081902080546001600160a01b0319163390811790915581519081529182018490527f4ea9a4c2644295403d8e347c48692cc92bf605a5fb4b31e88976a41e5b1199c2910160405180910390a150505050565b6040518060e001604052806000815260200160006001600160a01b031681526020016060815260200160001515815260200160001515815260200160008152602001600081525090565b60006020828403121561097d57600080fd5b5035919050565b60006020828403121561099657600080fd5b81356001600160a01b03811681146109ad57600080fd5b9392505050565b60006020808301818452808551808352604092508286019150828160051b8701018488016000805b84811015610aab57898403603f19018652825180518552888101516001600160a01b0316898601528781015160e089870181905281519087018190528491905b80831015610a3b578183018c01518884016101000152918b0191610a1c565b61010092508583828a0101526060915081840151610a5c838a018215159052565b506080915081840151610a72838a018215159052565b5060a0848101519089015260c093840151938801939093525096890196601f909101601f191690940190930192918701916001016109dc565b50919998505050505050505050565b634e487b7160e01b600052604160045260246000fd5b801515811461016257600080fd5b8035610ae981610ad0565b919050565b60008060408385031215610b0157600080fd5b823567ffffffffffffffff80821115610b1957600080fd5b818501915085601f830112610b2d57600080fd5b813581811115610b3f57610b3f610aba565b604051601f8201601f19908116603f01168101908382118183101715610b6757610b67610aba565b81604052828152886020848701011115610b8057600080fd5b826020860160208301376000602084830101528096505050505050610ba760208401610ade565b90509250929050565b600060018201610bd057634e487b7160e01b600052601160045260246000fd5b5060010190565b634e487b7160e01b600052603260045260246000fd5b600181811c90821680610c0157607f821691505b602082108103610c2157634e487b7160e01b600052602260045260246000fd5b50919050565b600060208284031215610c3957600080fd5b81516109ad81610ad0565b601f821115610c8e57600081815260208120601f850160051c81016020861015610c6b5750805b601f850160051c820191505b81811015610c8a57828155600101610c77565b5050505b505050565b815167ffffffffffffffff811115610cad57610cad610aba565b610cc181610cbb8454610bed565b84610c44565b602080601f831160018114610cf65760008415610cde5750858301515b600019600386901b1c1916600185901b178555610c8a565b600085815260208120601f198616915b82811015610d2557888601518255948401946001909101908401610d06565b5085821015610d435787850151600019600388901b60f8161c191681555b5050505050600190811b0190555056fea264697066735822122055b1cea1108cd750d082ed449603e6b2ada940dab422c08c6e41d411ccb742ca64736f6c6343000814003360806040523480156200001157600080fd5b506040518060400160405280600781526020016626bcaa37b5b2b760c91b815250604051806040016040528060038152602001624d544b60e81b81525081600390816200005f9190620002cd565b5060046200006e8282620002cd565b505050620000a83362000086620000ae60201b60201c565b6200009390600a620004ae565b620000a290620f4240620004c6565b620000b3565b620004f6565b601290565b6001600160a01b038216620000e35760405163ec442f0560e01b8152600060048201526024015b60405180910390fd5b620000f160008383620000f5565b5050565b6001600160a01b03831662000124578060026000828254620001189190620004e0565b90915550620001989050565b6001600160a01b03831660009081526020819052604090205481811015620001795760405163391434e360e21b81526001600160a01b03851660048201526024810182905260448101839052606401620000da565b6001600160a01b03841660009081526020819052604090209082900390555b6001600160a01b038216620001b657600280548290039055620001d5565b6001600160a01b03821660009081526020819052604090208054820190555b816001600160a01b0316836001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516200021b91815260200190565b60405180910390a3505050565b634e487b7160e01b600052604160045260246000fd5b600181811c908216806200025357607f821691505b6020821081036200027457634e487b7160e01b600052602260045260246000fd5b50919050565b601f821115620002c857600081815260208120601f850160051c81016020861015620002a35750805b601f850160051c820191505b81811015620002c457828155600101620002af565b5050505b505050565b81516001600160401b03811115620002e957620002e962000228565b6200030181620002fa84546200023e565b846200027a565b602080601f831160018114620003395760008415620003205750858301515b600019600386901b1c1916600185901b178555620002c4565b600085815260208120601f198616915b828110156200036a5788860151825594840194600190910190840162000349565b5085821015620003895787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b634e487b7160e01b600052601160045260246000fd5b600181815b80851115620003f0578160001904821115620003d457620003d462000399565b80851615620003e257918102915b93841c9390800290620003b4565b509250929050565b6000826200040957506001620004a8565b816200041857506000620004a8565b81600181146200043157600281146200043c576200045c565b6001915050620004a8565b60ff84111562000450576200045062000399565b50506001821b620004a8565b5060208310610133831016604e8410600b841016171562000481575081810a620004a8565b6200048d8383620003af565b8060001904821115620004a457620004a462000399565b0290505b92915050565b6000620004bf60ff841683620003f8565b9392505050565b8082028115828204841417620004a857620004a862000399565b80820180821115620004a857620004a862000399565b61072080620005066000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063313ce56711610066578063313ce567146100fe57806370a082311461010d57806395d89b4114610136578063a9059cbb1461013e578063dd62ed3e1461015157600080fd5b806306fdde0314610098578063095ea7b3146100b657806318160ddd146100d957806323b872dd146100eb575b600080fd5b6100a061018a565b6040516100ad919061056a565b60405180910390f35b6100c96100c43660046105d4565b61021c565b60405190151581526020016100ad565b6002545b6040519081526020016100ad565b6100c96100f93660046105fe565b610236565b604051601281526020016100ad565b6100dd61011b36600461063a565b6001600160a01b031660009081526020819052604090205490565b6100a061025a565b6100c961014c3660046105d4565b610269565b6100dd61015f36600461065c565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b6060600380546101999061068f565b80601f01602080910402602001604051908101604052809291908181526020018280546101c59061068f565b80156102125780601f106101e757610100808354040283529160200191610212565b820191906000526020600020905b8154815290600101906020018083116101f557829003601f168201915b5050505050905090565b60003361022a818585610277565b60019150505b92915050565b600033610244858285610289565b61024f85858561030c565b506001949350505050565b6060600480546101999061068f565b60003361022a81858561030c565b610284838383600161036b565b505050565b6001600160a01b03838116600090815260016020908152604080832093861683529290522054600019811461030657818110156102f757604051637dc7a0d960e11b81526001600160a01b038416600482015260248101829052604481018390526064015b60405180910390fd5b6103068484848403600061036b565b50505050565b6001600160a01b03831661033657604051634b637e8f60e11b8152600060048201526024016102ee565b6001600160a01b0382166103605760405163ec442f0560e01b8152600060048201526024016102ee565b610284838383610440565b6001600160a01b0384166103955760405163e602df0560e01b8152600060048201526024016102ee565b6001600160a01b0383166103bf57604051634a1406b160e11b8152600060048201526024016102ee565b6001600160a01b038085166000908152600160209081526040808320938716835292905220829055801561030657826001600160a01b0316846001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161043291815260200190565b60405180910390a350505050565b6001600160a01b03831661046b57806002600082825461046091906106c9565b909155506104dd9050565b6001600160a01b038316600090815260208190526040902054818110156104be5760405163391434e360e21b81526001600160a01b038516600482015260248101829052604481018390526064016102ee565b6001600160a01b03841660009081526020819052604090209082900390555b6001600160a01b0382166104f957600280548290039055610518565b6001600160a01b03821660009081526020819052604090208054820190555b816001600160a01b0316836001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405161055d91815260200190565b60405180910390a3505050565b600060208083528351808285015260005b818110156105975785810183015185820160400152820161057b565b506000604082860101526040601f19601f8301168501019250505092915050565b80356001600160a01b03811681146105cf57600080fd5b919050565b600080604083850312156105e757600080fd5b6105f0836105b8565b946020939093013593505050565b60008060006060848603121561061357600080fd5b61061c846105b8565b925061062a602085016105b8565b9150604084013590509250925092565b60006020828403121561064c57600080fd5b610655826105b8565b9392505050565b6000806040838503121561066f57600080fd5b610678836105b8565b9150610686602084016105b8565b90509250929050565b600181811c908216806106a357607f821691505b6020821081036106c357634e487b7160e01b600052602260045260246000fd5b50919050565b8082018082111561023057634e487b7160e01b600052601160045260246000fdfea2646970667358221220177c1672099f569d7b3748094038a2f5d87001cef179e3af083c4a01cbf3884564736f6c63430008140033",
  deployedBytecode:
    "0x608060405234801561001057600080fd5b50600436106100a95760003560e01c80638834c891116100715780638834c891146101545780638da5cb5b14610165578063aee5c34914610178578063bc7bf1c71461018d578063c9085875146101a0578063d4ccd5f3146101c057600080fd5b8063204ff240146100ae5780633feff76d146100c357806363035f66146100f3578063725009d3146101215780637e9dffe614610134575b600080fd5b6100c16100bc36600461096b565b6101d3565b005b6000546100d6906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b61011361010136600461096b565b60066020526000908152604090205481565b6040519081526020016100ea565b6100c161012f36600461096b565b6102c8565b61011361014236600461096b565b60056020526000908152604090205481565b6100c1610162366004610984565b50565b6001546100d6906001600160a01b031681565b61018061031c565b6040516100ea91906109b4565b6100c161019b36600461096b565b6105d8565b6101136101ae36600461096b565b60026020526000908152604090205481565b6100c16101ce366004610aee565b61078a565b60008181526006602052604081208054916101ed83610bb0565b9091555050600081815260066020526040902054600a101561028c5760016003828154811061021e5761021e610bd7565b906000526020600020906006020160030160016101000a81548160ff0219169083151502179055507fb1c8a09f3f65c01ce2ad5471f151a4d0ca61d365bcd286c0f0041845538f2b098160016040516102839291909182521515602082015260400190565b60405180910390a15b604080518281523360208201527fc6c773bb48fb8d38ada891d09df01af1f307f2a1bc38bb513c5cb1950150038191015b60405180910390a150565b60008181526005602052604081208054916102e283610bb0565b9091555050604080518281523360208201527fcf765d6f163c9b0d832e2a94f4c8e9bffd32a2c3ca5fdbb8cc67b5fe1441f41391016102bd565b60035460609060009067ffffffffffffffff81111561033d5761033d610aba565b60405190808252806020026020018201604052801561037657816020015b610363610921565b81526020019060019003908161035b5790505b5090506000805b600354811015610523576003818154811061039a5761039a610bd7565b6000918252602082206003600690920201015460ff161515900361051157600381815481106103cb576103cb610bd7565b90600052602060002090600602016040518060e0016040529081600082015481526020016001820160009054906101000a90046001600160a01b03166001600160a01b03166001600160a01b0316815260200160028201805461042d90610bed565b80601f016020809104026020016040519081016040528092919081815260200182805461045990610bed565b80156104a65780601f1061047b576101008083540402835291602001916104a6565b820191906000526020600020905b81548152906001019060200180831161048957829003601f168201915b5050509183525050600382015460ff8082161515602084015261010090910416151560408201526004820154606082015260059091015460809091015283518490849081106104f7576104f7610bd7565b6020026020010181905250818061050d90610bb0565b9250505b8061051b81610bb0565b91505061037d565b5060008167ffffffffffffffff81111561053f5761053f610aba565b60405190808252806020026020018201604052801561057857816020015b610565610921565b81526020019060019003908161055d5790505b50905060005b828110156105d05783818151811061059857610598610bd7565b60200260200101518282815181106105b2576105b2610bd7565b602002602001018190525080806105c890610bb0565b91505061057e565b509392505050565b600381815481106105eb576105eb610bd7565b906000526020600020906006020160030160019054906101000a900460ff16156106535760405162461bcd60e51b81526020600482015260156024820152741c1bdcdd08185b1c9958591e481d995c9a599a5959605a1b604482015260640160405180910390fd5b600081815260066020526040902054600a10156101625760016003828154811061067f5761067f610bd7565b906000526020600020906006020160030160016101000a81548160ff0219169083151502179055507fb1c8a09f3f65c01ce2ad5471f151a4d0ca61d365bcd286c0f0041845538f2b098160016040516106e49291909182521515602082015260400190565b60405180910390a160008181526004602081815260408084205460029092528084206064908190559354905163a9059cbb60e01b81526001600160a01b039283169381018490526024810185905292939291169063a9059cbb906044016020604051808303816000875af1158015610760573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107849190610c27565b50505050565b600380546040805160e0810182528281523360208201908152918101868152851515606083015260006080830181905260a0830181905260c0830181905260018501865594855281517fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b6006860290810191825593517fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85c850180546001600160a01b0319166001600160a01b039092169190911790559051939493919290917fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85d909101906108789082610c93565b506060820151600382018054608085015115156101000261ff00199315159390931661ffff199091161791909117905560a082015160048083019190915560c0909201516005909101556000838152602091825260409081902080546001600160a01b0319163390811790915581519081529182018490527f4ea9a4c2644295403d8e347c48692cc92bf605a5fb4b31e88976a41e5b1199c2910160405180910390a150505050565b6040518060e001604052806000815260200160006001600160a01b031681526020016060815260200160001515815260200160001515815260200160008152602001600081525090565b60006020828403121561097d57600080fd5b5035919050565b60006020828403121561099657600080fd5b81356001600160a01b03811681146109ad57600080fd5b9392505050565b60006020808301818452808551808352604092508286019150828160051b8701018488016000805b84811015610aab57898403603f19018652825180518552888101516001600160a01b0316898601528781015160e089870181905281519087018190528491905b80831015610a3b578183018c01518884016101000152918b0191610a1c565b61010092508583828a0101526060915081840151610a5c838a018215159052565b506080915081840151610a72838a018215159052565b5060a0848101519089015260c093840151938801939093525096890196601f909101601f191690940190930192918701916001016109dc565b50919998505050505050505050565b634e487b7160e01b600052604160045260246000fd5b801515811461016257600080fd5b8035610ae981610ad0565b919050565b60008060408385031215610b0157600080fd5b823567ffffffffffffffff80821115610b1957600080fd5b818501915085601f830112610b2d57600080fd5b813581811115610b3f57610b3f610aba565b604051601f8201601f19908116603f01168101908382118183101715610b6757610b67610aba565b81604052828152886020848701011115610b8057600080fd5b826020860160208301376000602084830101528096505050505050610ba760208401610ade565b90509250929050565b600060018201610bd057634e487b7160e01b600052601160045260246000fd5b5060010190565b634e487b7160e01b600052603260045260246000fd5b600181811c90821680610c0157607f821691505b602082108103610c2157634e487b7160e01b600052602260045260246000fd5b50919050565b600060208284031215610c3957600080fd5b81516109ad81610ad0565b601f821115610c8e57600081815260208120601f850160051c81016020861015610c6b5750805b601f850160051c820191505b81811015610c8a57828155600101610c77565b5050505b505050565b815167ffffffffffffffff811115610cad57610cad610aba565b610cc181610cbb8454610bed565b84610c44565b602080601f831160018114610cf65760008415610cde5750858301515b600019600386901b1c1916600185901b178555610c8a565b600085815260208120601f198616915b82811015610d2557888601518255948401946001909101908401610d06565b5085821015610d435787850151600019600388901b60f8161c191681555b5050505050600190811b0190555056fea264697066735822122055b1cea1108cd750d082ed449603e6b2ada940dab422c08c6e41d411ccb742ca64736f6c63430008140033",
  linkReferences: {},
  deployedLinkReferences: {},
  networks: {
    // replace the address and the hash
    "11155111": {
      address: "0x5FC8d32690cc91D4c39d9d3abcBD16989F875707",
      transactionHash:
        "0x8df0fd543530b767f82b9b15e6d17a9b43f6b27aebb963d3d5609b3479f2efb0",
    },
  },
};

const contractABI = MyValContract.abi;
const contractAddress =
  "0x5FC8d32690cc91D4c39d9d3abcBD16989F875707";

const NewPostForm: React.FC<NewPostFormProps> = ({ web3, account }) => {
  const [postText, setPostText] = useState<string>("");

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault();
    const contract = new web3.eth.Contract(
      MyValContract.abi,
      MyValContract.networks[11155111].address
    );

    try {
      const provider = new ethers.providers.JsonRpcProvider(
        "http://127.0.0.1:8545/"
      );

      const contract = new ethers.Contract(
        contractAddress,
        contractABI,
        provider.getSigner()
      );

      const content = postText;
      const tx = await contract.addpost(content, false);
    } catch (error) {
      console.log("Failed to fetch", error);
    }
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <Textarea
          value={postText}
          onChange={(e) => setPostText(e.target.value)}
          placeholder="Write your post"
          required
        />
        <Button type="submit">Submit Post</Button>
      </form>
    </div>
  );
};

export default NewPostForm;
